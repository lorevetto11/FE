<div data-ng-if="selectedOrganization && loading">
	<br/><br/><br/><br/><br/>
	<h3 class="text-primary text-center">
		<i class="fa fa-2x fa-circle-o-notch fa-spin"></i><br/>
		{{'common.tableAndForm.loading.name'|translate}}...
	</h3>
	<br/><br/><br/><br/><br/>
</div>

<div class="riskAnalysis-home" data-ng-if="!loading && selectedOrganization">
	<div class="row" style="margin-top: -20px">
		<div class="col col-xs-12">
			<div class="panel panel-default">
				<!--<div class="panel-heading">-->
				<!--</div>-->
				<div class="panel-body">
					<div data-ng-if="!selectedItem">
						<div data-ng-if="diagrams.length > 0">
							<div class="row">
								<div class="col col-xs-12 col-md-2">
									<label>
										{{ 'common.tableAndForm.diagram.name' | translate }}:
									</label>
								</div>
								<div class="col col-xs-12 col-md-10">
									<select class="form-control"
									        data-ng-options="diagram as diagram.name for diagram in diagrams | orderBy: diagram.name"
									        data-ng-model="selected.diagram"
									        data-ng-change="loadShapes(selected.diagram)">
										<option data-ng-if="selected.diagram == null"
										        data-ng-selected="true" value="" selected="selected">
											{{'common.tableAndForm.selectDiagram.name'|translate}}
										</option>
									</select>
								</div>
							</div>
							<br>
							<div class="row" data-ng-if="selected.diagram != null">
								<div class="col col-xs-12 col-md-6">
									<div class="panel panel-default">
										<div class="panel-heading">
											{{'nav.riskAnalysis.sub.commonSub.materialsInvolved'|translate}}
										</div>
										<div class="panel-body">
											<div style="max-height: 100%">
												<div class="slimScrollDiv"
												     style="position: relative; overflow: hidden; width: auto; height: 100%;">
													<div class="filterbox-vertical" data-slim-scroll=""
													     style="overflow: hidden; width: auto; height: 100%;">
														<section class="panel panel-default mail-categories">
															<div class="alert alert-info" style="margin-bottom: 0;"
															     data-ng-if="(filtered.materials).length == 0">
																{{"nav.riskAnalysis.sub.messages.noMaterials"|translate}}
															</div>
															<ul class="list-group list-group-flush">
																<li class="list-group-item"
																    data-ng-repeat="material in filtered.materials">
																	<div style="padding: 15px;">
																		{{material.name}}
																	</div>
																</li>
															</ul>
														</section>
													</div>
													<div class="slimScrollBar"
													     style="background: rgb(0, 0, 0); width: 7px; position: absolute; top: 0px; opacity: 0.4; display: none; border-radius: 7px; z-index: 99; right: 1px; height: 2287px;">
													</div>
													<div class="slimScrollRail"
													     style="width: 7px; height: 100%; position: absolute; top: 0px; display: none; border-radius: 7px; background: rgb(51, 51, 51); opacity: 0.2; z-index: 90; right: 1px;">
													</div>
												</div>
											</div>
										</div>
									</div>
								</div>
								<div class="col col-xs-12 col-md-6">
									<div class="panel panel-default">
										<div class="panel-heading">
											{{'nav.riskAnalysis.sub.commonSub.dangers'|translate}}
										</div>
										<div class="panel-body">
											<div style="max-height: 100%">
												<div class="slimScrollDiv"
												     style="position: relative; overflow: hidden; width: auto; height: 100%;">
													<div class="filterbox-vertical" data-slim-scroll=""
													     style="overflow: hidden; width: auto; height: 100%;">
														<section class="panel panel-default mail-categories">
															<div class="alert alert-info" style="margin-bottom: 0;"
															     data-ng-if="(filtered.dangers).length == 0">
																{{"nav.riskAnalysis.sub.messages.noDangers"|translate}}
															</div>
															<ul class="list-group">
																<li class="list-group-item"
																    data-ng-class="riskMapColor[riskMap[item.risk]]"
																    data-ng-repeat="item in filtered.dangers">
																	<div style="padding:15px;">
																		{{item.name }}
																	</div>
																</li>
															</ul>
														</section>
													</div>
													<div class="slimScrollBar"
													     style="background: rgb(0, 0, 0); width: 7px; position: absolute; top: 0px; opacity: 0.4; display: none; border-radius: 7px; z-index: 99; right: 1px; height: 2287px;">
													</div>
													<div class="slimScrollRail"
													     style="width: 7px; height: 100%; position: absolute; top: 0px; display: none; border-radius: 7px; background: rgb(51, 51, 51); opacity: 0.2; z-index: 90; right: 1px;">
													</div>
												</div>
											</div>
										</div>
									</div>
								</div>
							</div>
							<div class="row" data-ng-if="selected.diagram != null">
								<div class="col col-sm-12">
									<div class="panel panel-default">
										<div class="panel-heading">
											{{'nav.riskAnalysis.sub.commonSub.phases'|translate}}
										</div>
										<div class="panel-body">
											<div class="row">
												<div class="col col-sm-12 col-md-4">
													<div style="max-height: 100%">
														<div class="slimScrollDiv"
														     style="position: relative; overflow: hidden; width: auto; height: 100%;">
															<div class="filterbox-vertical" data-slim-scroll=""
															     style="overflow: hidden; width: auto; height: 100%;">
																<section class="panel panel-default mail-categories">
																	<div class="alert alert-info" style="margin-bottom: 0;"
																	     data-ng-if="(filtered.entities).length == 0">
																		{{"nav.riskAnalysis.sub.messages.noPhases"|translate}}
																	</div>
																	<ul class="list-group">
																		<li class="list-group-item"
																		    data-ng-repeat="entity in filtered.entities"
																		    data-ng-style=" getColor(entity) "
																		    data-ng-click="selectPhase(entity)"
																			data-ng-class="{'active' : entity.id === selected.phase.id}">
																			<a>
																				{{entity.name }}
																				<small class="pull-right help-block ng-binding">
																					{{entity.typeCCP}}
																				</small>
																			</a>
																		</li>
																	</ul>
																</section>
															</div>
															<div class="slimScrollBar"
															     style="background: rgb(0, 0, 0); width: 7px; position: absolute; top: 0px; opacity: 0.4; display: none; border-radius: 7px; z-index: 99; right: 1px; height: 2287px;">
															</div>
															<div class="slimScrollRail"
															     style="width: 7px; height: 100%; position: absolute; top: 0px; display: none; border-radius: 7px; background: rgb(51, 51, 51); opacity: 0.2; z-index: 90; right: 1px;">
															</div>
														</div>
													</div>
												</div>
												<div class="col col-sm-12 col-md-8" data-ng-if="selected.phase" data-ng-init="survey = {}">
													<div class="panel" style="margin-bottom:0;" >
														<div class="panel-heading">
															<div class="media">
																<div class="media-body media-middle">
																	<div class="media-heading">
																		<span>{{ selected.phase.name }}</span>
																	</div>
																</div>
																<div class="media-right">
																	<div class="btn btn-default" title="cancel" data-ng-click="cancel()"
																	     role="button"
																	     tabindex="0">
																		<i class="fa fa-times"></i>
																	</div>
																</div>
															</div>
														</div>

														<div class="panel-body">

															<div data-ng-if=" selected.phase.typeCCP == null">

																<div data-ng-if=" ( survey.d1 === undefined
																		|| ( survey.d2 === true && survey.d1 === false ) )
																	|| ( survey.d1 != null ) ">
																	<div class="col col-12">
																		<strong>{{ 'riskAnalysis.panel.ccpTable.heading.d1' | translate }}</strong>
																	</div>
																	<br>
																	<div class="col col-12 text-center">
																		<div class="radio-inline">
																			<label>
																				<input name="ccp"
																				       type="radio"
																				       data-ng-value="true"
																				       data-ng-model="survey.d1">
																				Yes
																			</label>
																		</div>
																		<div class="radio-inline">
																			<label>
																				<input name="optionsRadios"
																				       type="radio"
																				       data-ng-value="false"
																				       data-ng-model="survey.d1">
																				No
																			</label>
																		</div>
																	</div>
																</div>

																<div data-ng-if="  ( survey.d1 === false
																	&& survey.d2 === undefined )
																	|| ( survey.d2 != null ) ">
																	<div class="col col-12">
																		<strong>{{ 'riskAnalysis.panel.ccpTable.heading.d2' | translate }}</strong>
																	</div>
																	<br>
																	<div class="col col-12 text-center">
																		<div class="radio-inline">
																			<label>
																				<input name="ccp"
																				       type="radio"
																				       data-ng-value="true"
																				       data-ng-click="survey.d1 = undefined;
																                        survey.d2 = undefined;">
																				Yes
																			</label>
																		</div>
																		<div class="radio-inline">
																			<label>
																				<input name="optionsRadios"
																				       type="radio"
																				       data-ng-value="false"
																				       data-ng-click="editPhase( selected.phase, 'NONE' )">
																				No
																			</label>
																		</div>
																	</div>
																</div>

																<div data-ng-if=" survey.d1 === true
																	&& survey.d3 === undefined
																|| survey.d3 != null">
																	<div class="col col-12">
																		<strong>{{ 'riskAnalysis.panel.ccpTable.heading.d3' | translate }}</strong>
																	</div>
																	<br>
																	<div class="col col-12 text-center">
																		<div class="radio-inline">
																			<label>
																				<input name="ccp"
																				       type="radio"
																				       data-ng-value="true"
																				       data-ng-click="editPhase( selected.phase, 'CCP' )">
																				Yes
																			</label>
																		</div>
																		<div class="radio-inline">
																			<label>
																				<input name="optionsRadios"
																				       type="radio"
																				       data-ng-value="false"
																				       data-ng-model="survey.d3">
																				No
																			</label>
																		</div>
																	</div>
																</div>

																<div data-ng-if=" survey.d3 === false
												                    && survey.d4 === undefined
												                || survey.d4 != null">
																	<div class="col col-12">
																		<strong>{{ 'riskAnalysis.panel.ccpTable.heading.d4' | translate }}</strong>
																	</div>
																	<br>
																	<div class="col col-12 text-center">
																		<div class="radio-inline">
																			<label>
																				<input name="ccp"
																				       type="radio"
																				       data-ng-value="true"
																				       data-ng-model="survey.d4">
																				Yes
																			</label>
																		</div>
																		<div class="radio-inline">
																			<label>
																				<input name="optionsRadios"
																				       type="radio"
																				       data-ng-value="false"
																				       data-ng-click="editPhase( selected.phase, 'NONE' )">
																				No
																			</label>
																		</div>
																	</div>
																</div>

																<div data-ng-if=" survey.d4 === true
												                    && survey.d5 === undefined
												                || survey.d5 != null">
																	<div class="col col-12">
																		<strong>{{ 'riskAnalysis.panel.ccpTable.heading.d5' | translate }}</strong>
																	</div>
																	<br>
																	<div class="col col-12 text-center">
																		<div class="radio-inline">
																			<label>
																				<input name="ccp"
																				       type="radio"
																				       data-ng-value="true"
																				       data-ng-click="editPhase( selected.phase, 'NONE' )">
																				Yes
																			</label>
																		</div>
																		<div class="radio-inline">
																			<label>
																				<input name="optionsRadios"
																				       type="radio"
																				       data-ng-value="false"
																				       data-ng-model="survey.d5">
																				No
																			</label>
																		</div>
																	</div>
																</div>

																<div data-ng-if=" survey.d5 === false
												                    && survey.d6 === undefined
												                || survey.d6 != null">
																	<div class="col col-12">
																		<strong>{{ 'riskAnalysis.panel.ccpTable.heading.d6' | translate }}</strong>
																	</div>
																	<br>
																	<div class="col col-12 text-center">
																		<div class="radio-inline">
																			<label>
																				<input name="ccp"
																				       type="radio"
																				       data-ng-value="true"
																				       data-ng-click="editPhase( selected.phase, 'CCP' )">
																				CCP
																			</label>
																		</div>
																		<div class="radio-inline">
																			<label>
																				<input name="optionsRadios"
																				       type="radio"
																				       data-ng-value="false"
																				       data-ng-click="editPhase( selected.phase, 'OPRP' )">
																				OPRP
																			</label>
																		</div>
																	</div>
																</div>

															</div>

															<div data-ng-if=" selected.phase.typeCCP === 'CCP'
																|| selected.phase.typeCCP === 'OPRP'
																|| selected.phase.typeCCP === 'NONE' ">

																<div class="alert alert-info">
																<span>
																	{{'common.tableAndForm.phaseMarked.name'|translate}} <b>
																	{{ 'common.tableAndForm.phaseStatus.' + selected.phase.typeCCP | translate }}
																	</b>
																	<button style="transform: translateY(-15%)"
																	        class="btn btn-sm btn-primary pull-right"
																	        data-ng-click="editPhase(selected.phase)">
																		{{'common.button.form.reassesses'|translate}} &nbsp;
																		<i class="glyphicon glyphicon-pencil"></i>
																	</button>
																</span>
																</div>

															</div>

														</div>
													</div>
													<div class="panel" style="margin-bottom:0;" data-ng-if=" selected.phase.typeCCP !== 'NONE'
																			&& selected.phase.typeCCP != null ">
														<div class="panel-heading">
															<div class="media">
																<div class="media-body media-middle">
																	<div class="media-heading">
																		<span>{{'nav.riskAnalysis.sub.commonSub.dangers'|translate}}</span>
																	</div>
																</div>
															</div>
														</div>
														<div class="panel-body">
															<div class="alert alert-info" style="margin-bottom: 0;"
															     data-ng-if="(filtered.dangers).length == 0">
																{{"nav.riskAnalysis.sub.messages.noDangers"|translate}}
															</div>
															<div data-ng-if="(filtered.dangers).length != 0">
																<select class="form-control"
																        data-ng-options="item as item.name for item in filtered.dangers"
																        data-ng-change="loadRiskMapRelation()"
																        data-ng-model="selected.danger">
																	<option data-ng-selected="true" value="" selected="selected"
																			data-ng-if="selected.danger == null">
																		{{'common.tableAndForm.selectDiagram.name'|translate}}
																	</option>
																</select>
															</div>
															<div data-ng-if="selected.danger != null">
																<table class="table table-risk table-bordered">
																	<thead>
																		<tr>
																			<th class="split-cell">
																				<div>
																					<span class="top">{{'riskAnalysis.panel.riskMap.seriousness.risk'|translate}}</span>
																					<span class="bottom">{{'riskAnalysis.panel.riskMap.frequency.probability'|translate}}</span>
																				</div>
																			</th>
																			<th>{{'riskAnalysis.panel.riskMap.seriousness.nonRelevant'|translate}}</th>
																			<th>{{'riskAnalysis.panel.riskMap.seriousness.significant'|translate}}</th>
																			<th>{{'riskAnalysis.panel.riskMap.seriousness.critical'|translate}}</th>
																			<th>{{'riskAnalysis.panel.riskMap.seriousness.serious'|translate}}</th>
																		</tr>
																	</thead>
																	<tbody>
																		<tr>
																			<th>{{'riskAnalysis.panel.riskMap.frequency.frequent'|translate}}</th>
																			<td data-ng-repeat="value in [12,13,14,15]"
																			    data-ng-click="saveRiskMapRelation(value)"
																			    data-ng-class=" 'bg-' + riskMapColor[riskMap[value]]">
																				<div data-ng-if="riskMapRelation.value == value">
																					<strong>{{selected.danger.name}}</strong>
																				</div>
																			</td>
																		</tr>
																		<tr>
																			<th>{{'riskAnalysis.panel.riskMap.frequency.probable'|translate}}</th>
																			<td data-ng-repeat="value in [8,9,10,11]"
																			    data-ng-click="saveRiskMapRelation(value)"
																			    data-ng-class=" 'bg-' + riskMapColor[riskMap[value]]">
																				<div data-ng-if="riskMapRelation.value == value">
																					<strong>{{selected.danger.name}}</strong>
																				</div>
																			</td>
																		</tr>
																		<tr>
																			<th>{{'riskAnalysis.panel.riskMap.frequency.occasional'|translate}}</th>
																			<td data-ng-repeat="value in [4,5,6,7]"
																			    data-ng-click="saveRiskMapRelation(value)"
																			    data-ng-class=" 'bg-' + riskMapColor[riskMap[value]]">
																				<div data-ng-if="riskMapRelation.value == value">
																					<strong>{{selected.danger.name}}</strong>
																				</div>
																			</td>
																		</tr>
																		<tr>
																			<th>{{'riskAnalysis.panel.riskMap.frequency.improbable'|translate}}</th>
																			<td data-ng-repeat="value in [0,1,2,3]"
																			    data-ng-click="saveRiskMapRelation(value)"
																			    data-ng-class=" 'bg-' + riskMapColor[riskMap[value]]">
																				<div data-ng-if="riskMapRelation.value == value">
																					<strong>{{selected.danger.name}}</strong>
																				</div>
																			</td>
																		</tr>
																	</tbody>


																</table>
															</div>
														</div>
													</div>
													<div class="panel" style="margin-bottom:0;" data-ng-if=" selected.phase.typeCCP !== 'NONE'
																			&& selected.phase.typeCCP != null ">
														<div class="panel-heading">
															<div class="media">
																<div class="media-body media-middle">
																	<div class="media-heading">
																		<span>{{'nav.data.sub.commonSub.monitorings'|translate}}</span>
																	</div>
																</div>
															</div>
														</div>
														<div class="panel-body">
															<phase-monitorings data-phase="selected.phase"></phase-monitorings>
														</div>
													</div>
												</div>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
						<div data-ng-if="diagrams.length == 0">
							<div class="alert alert-info">{{'nav.riskAnalysis.sub.messages.noDiagrams'|translate}}</div>
						</div>
					</div>

					<div class="row" data-ng-if="selectedItem">
						<div class="col col-sm-4">
							<div class="panel" data-ng-class="'panel-' + riskMapColor[riskMap[originalItem.risk]]">
								<div class="panel-heading">{{ selectedItem.name }}
									<span class="pull-right">{{selectedItem.type}}</span>
								</div>
								<div class="panel-body">
									<div class="form-group">
										<div class="row">
											<div class="col col-md-4">
												<label>{{'common.disease.description'|translate}}</label></div>
											<div class="col col-md-8">
												<span data-ng-bind-html="selectedItem.description"></span>
											</div>
										</div>
									</div>

									<div class="form-group">
										<div class="row">
											<div class="col col-md-4"><label>{{'common.disease.controlMeasure'|translate}}</label>
											</div>
											<div class="col col-md-8">
												<span data-ng-bind-html="selectedItem.controlMeasure"></span>
											</div>
										</div>
									</div>
									<div class="form-group">
										<div class="row">
											<div class="col col-md-4">
												<label>{{'common.disease.criticalLimit'|translate}}</label></label>
											</div>
											<div class="col col-md-8">
												<span data-ng-bind-html="selectedItem.criticalLimit"></span>
											</div>
										</div>
									</div>
									<div class="form-group">
										<div class="row">
											<div class="col col-md-4">
												<label>{{'common.disease.procedures'|translate}}</label></div>
											<div class="col col-md-8">
												<span data-ng-bind-html="selectedItem.procedures"></span>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
						<div class="col col-sm-8">
							<div class="panel">
								<div class="panel-heading">
									<div class="media">
										<div class="media-body media-middle">
											<div class="media-heading">
												<span>{{'nav.riskAnalysis.sub.commonSub.riskMap'|translate}}</span>
											</div>
										</div>
										<div class="media-right">
											<div class="btn btn-default" title="cancel" data-ng-click="cancel()"
											     role="button"
											     tabindex="0">
												<i class="fa fa-times"></i>
											</div>
										</div>
									</div>
								</div>

							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>
